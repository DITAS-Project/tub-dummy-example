# Request-Monitor
The request-monitor consists of a nginx reverse-proxy and a logstash distribution which maps and send the nginx log file to the elasticsearch

## Usage
Like the whole project the request-monitor can be started using ```sudo docker-compose up ```

## Components

### nginx reverse proxy
To change the logfile metrics you can add or remove attributes in the nginx.conf file in the http block  *'log_format'*  

#### the current log metric contains the following attributes:
* "$time_local" -- the time when the log is written
* "$remote_addr" -- client IP, since its running in a docker container it's the docker intern IP
* "$request" -- the full HTTP request
* "$request_time" -- time it took between first byte received from client to last byte sent to client
* "$upstream_response_time" -- time the vdc took for the response
* "$request_id" -- unique ID generated by nginx which is passed on in the header
* "$status" -- HTTP status code
* "$body_bytes_sent" -- Bytes send in response body

there are several different options you might like to try, but note the format for log format **' "[attribute-name]":"[$attribute-name]", '**

#### Options I encountered:
* "$http_referer" -- http referer
* "$http_user_agent" -- http user agent name
* "$http_x_forwarded_for" -- forwarded client IP adress
* "$remote_user" -- remote user if specified
* "$upstream_connect_time" -- Time spent establishing a connection with an upstream server
* "$upstream_header_time" -- Time between establishing a connection to an upstream server and receiving the first byte of the response header
* "$request_length" -- length of the request
* "$upstream_addr" -- IP of the upstream server
* "$upstream_status" -- HTTP status code of the upstream server
* "$request_method" -- HTTP request method
* basically every header attribute send

### logstash
logstash maps the nginx logfile so that every attribute becomes a field in the elasticsearch
if you don't want a specific attribute to become a field remove it by adding  **'remove_field => ["[attribute]"]'** to the logstash mutate block
logstash creates the elastic indexes based on a environmental variable set in the docker-compose file and the current date if you want to change that look in the output block **'index =>"[your new index name]"'**
